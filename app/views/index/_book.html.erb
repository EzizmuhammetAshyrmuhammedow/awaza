<div class="w-full max-w-2xl mx-auto p-4" data-controller="hotel-search">
  <div class="bg-white dark:bg-zinc-900 rounded-md shadow flex flex-col sm:flex-row items-stretch sm:items-center justify-between space-y-2 sm:space-y-0 p-2">
    <%= form_with url: search_hotels_path, method: :get, local: true, turbo: true, html: { class: "flex flex-wrap gap-3 w-full" } do |f| %>

      <!-- Check-in Field -->
      <div class="flex flex-col w-full sm:flex-1 sm:border-r dark:border-zinc-700 border-gray-200 px-2">
        <%= f.text_field :check_in, id: "checkin", autocomplete: "off",
                         data: { action: "change->hotel-search#updateCheckIn" },
                         class: "w-full p-2 bg-transparent border border-gray-300 rounded-md placeholder-gray-400",
                         required: true,
                         placeholder: t('booking.check_in') %>
      </div>

      <!-- Check-out Field -->
      <div class="flex flex-col w-full sm:flex-1 sm:border-r dark:border-zinc-700 border-gray-200 px-2">
        <%= f.text_field :check_out, id: "checkout", autocomplete: "off",
                         data: { action: "change->hotel-search#updateCheckOut" },
                         class: "w-full p-2 bg-transparent border border-gray-300 rounded-md placeholder-gray-400",
                         required: true,
                         placeholder: t('booking.check_out') %>
      </div>

      <!-- Hidden fields for computed values -->
      <%= f.hidden_field :guests, value: 1, data: { hotel_search_target: "guests" } %>
      <%= hidden_field_tag :rooms, 1, data: { hotel_search_target: "roomsHidden" } %>

      <!-- Popover Trigger Button -->
      <div class="relative w-full sm:w-auto">
        <button type="button"
                popovertarget="popover"
                class="w-full sm:w-auto px-4 py-2 rounded bg-gray-200 hover:bg-gray-300 dark:bg-zinc-800 hover:dark:bg-zinc-950 cursor-pointer transition ease-in-out duration-250"
                data-hotel-search-target="popoverButton">
          <span data-hotel-search-target="guestCount"><%= t('guests.one') %></span>
          <span data-hotel-search-target="roomCount"><%= t('rooms.rooms.one') %></span>
        </button>

        <!-- Popover -->
        <div id="popover" popover data-hotel-search-target="popover"
             class="absolute left-0 sm:left-1/2 transform sm:-translate-x-1/2 mt-2 w-full sm:w-56 p-4 bg-white shadow-lg rounded border border-gray-200 z-10">
          <!-- Adults -->
          <div class="flex justify-between items-center mt-2">
            <%= t('adults.plural') %>
            <div class="flex items-center">
              <button type="button" data-action="click->hotel-search#decrementAdults" class="px-2 border rounded">-</button>
              <input type="number" name="adults" min="1" value="1"
                     data-hotel-search_target="adults"
                     class="w-10 text-center border mx-2">
              <button type="button" data-action="click->hotel-search#incrementAdults" class="px-2 border rounded">+</button>
            </div>
          </div>

          <!-- Children -->
          <div class="flex justify-between items-center mt-2">
            <%= t('children.plural') %>
            <div class="flex items-center">
              <button type="button" data-action="click->hotel-search#decrementChildren" class="px-2 border rounded">-</button>
              <input type="number" name="children" min="0" value="0"
                     data-hotel-search-target="children"
                     class="w-10 text-center border mx-2">
              <button type="button" data-action="click->hotel-search#incrementChildren" class="px-2 border rounded">+</button>
            </div>
          </div>

          <!-- Rooms -->
          <div class="flex justify-between items-center mt-2">
            <%= t('rooms.rooms.plural') %>
            <div class="flex items-center">
              <button type="button" data-action="click->hotel-search#decrementRooms" class="px-2 border rounded">-</button>
              <input type="number" name="rooms_input" min="1" value="1"
                     data-hotel-search-target="rooms"
                     class="w-10 text-center border mx-2">
              <button type="button" data-action="click->hotel-search#incrementRooms" class="px-2 border rounded">+</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Search Button -->
      <div class="flex justify-center w-full sm:w-auto px-2">
        <%= f.submit t('search'), class: "w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-semibold px-5 py-2 rounded-md" %>
      </div>
    <% end %>
  </div>
</div>
